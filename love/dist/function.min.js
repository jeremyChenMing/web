var gardenCtx,gardenCanvas,$garden,garden,$window=$(window),clientWidth=$(window).width(),clientHeight=$(window).height();function getHeartPoint(t){var e=t/Math.PI,n=16*Math.pow(Math.sin(e),3)*19.5,a=-20*(13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e));return new Array(offsetX+n,offsetY+a)}function startHeartAnimation(){var o=10,i=new Array,s=setInterval(function(){for(var t=getHeartPoint(o),e=!0,n=0;n<i.length;n++){var a=i[n];if(Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2))<1.3*Garden.options.bloomRadius.max){e=!1;break}}e&&(i.push(t),garden.createRandomBloom(t[0],t[1])),30<=o?(clearInterval(s),showMessages()):o+=.2},50)}function overagain(){console.log("打完了"),$("#lastTxt").animate({left:"50%"},1e3,function(){$(".keywordbig").animate({fontSize:"50px"},1e3,function(){$(".keywordbig").toggle("bounce",{times:6},2e3,function(){setTimeout(function(){$("#messages").fadeOut(4e3),$("#loveu").fadeOut(4e3,function(){clearCanvas(),$("#lastTxt").css({left:"-50%"}),setTimeout(function(){$("#code").typewriter(),setTimeout(function(){startHeartAnimation()},5e4)},0)})},5e4)})})})}function clearCanvas(){$garden=$("#garden"),gardenCanvas=$garden[0],(gardenCtx=gardenCanvas.getContext("2d")).clearRect(0,0,gardenCanvas.width,gardenCanvas.height)}function timeElapse(t){var e=Date(),n=(Date.parse(e)-Date.parse(t))/1e3,a=Math.floor(n/86400);n%=86400;var o=Math.floor(n/3600);o<10&&(o="0"+o),n%=3600;var i=Math.floor(n/60);i<10&&(i="0"+i),(n%=60)<10&&(n="0"+n);var s='<span class="digit">'+a+'</span> days <span class="digit">'+o+'</span> hours <span class="digit">'+i+'</span> minutes <span class="digit">'+n+"</span> seconds";$("#elapseClock").html(s)}function showMessages(){adjustWordsPosition(),$("#messages").fadeIn(5e3,function(){showLoveU()})}function adjustWordsPosition(){$("#words").css("position","absolute"),$("#words").css("top",$("#garden").position().top+195),$("#words").css("left",$("#garden").position().left+70)}function adjustCodePosition(){$("#code").css("margin-top",($("#garden").height()-$("#code").height())/2)}function showLoveU(){$("#loveu").fadeIn(3e3,function(){console.log("loveu结束了"),overagain()})}$(function(){$loveHeart=$("#loveHeart");$loveHeart.width(),$loveHeart.height();$garden=$("#garden"),(gardenCanvas=$garden[0]).width=$("#loveHeart").width(),gardenCanvas.height=$("#loveHeart").height(),(gardenCtx=gardenCanvas.getContext("2d")).globalCompositeOperation="lighter",garden=new Garden(gardenCtx,gardenCanvas),$("#content").css("width",$loveHeart.width()+$("#code").width()),$("#content").css("height",Math.max($loveHeart.height(),$("#code").height())),$("#content").css("margin-left",Math.max(($window.width()-$("#content").width())/2,10)),setInterval(function(){garden.render()},Garden.options.growSpeed)}),$(window).resize(function(){var t=$(window).width(),e=$(window).height();t!=clientWidth&&e!=clientHeight&&location.replace(location)}),function(o){o.fn.typewriter=function(){return this.each(function(){var t=o(this),e=t.html(),n=0;t.html("");var a=setInterval(function(){"<"==e.substr(n,1)?n=e.indexOf(">",n)+1:n++,t.html(e.substring(0,n)+(1&n?"_":"")),n>=e.length&&clearInterval(a)},75)}),this}}(jQuery);